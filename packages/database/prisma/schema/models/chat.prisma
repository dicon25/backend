/// AI 채팅 세션 모델
/// 사용자와 AI 간의 대화 세션을 저장
/// 메인 페이지: 일반 자료조사, 논문 페이지: 특정 논문 질문/답변
model ChatSession {
  /// 세션 고유 ID (UUID)
  id String @id @default(uuid())

  /// 사용자 ID
  userId String

  /// 사용자 객체
  /// 사용자 삭제 시 채팅 세션도 함께 삭제 (Cascade)
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  /// 세션 이름
  /// 사용자가 지정하거나 자동 생성
  /// 예: "Transformer 모델에 대한 질문", "2024-01-15 대화"
  name String

  /// 연결된 논문 ID (선택 사항)
  /// null: 메인 페이지 자료조사 (일반 질문)
  /// 값 있음: 특정 논문에 대한 질문/답변
  paperId String?

  /// 이 세션의 메시지 목록
  messages ChatMessage[]

  /// 마지막 메시지 시각 (선택 사항)
  /// 세션 목록 정렬에 사용
  lastMessageAt DateTime?

  /// 세션 생성 시각
  createdAt DateTime @default(now())

  /// 세션 최종 수정 시각
  updatedAt DateTime @updatedAt

  /// 사용자별 채팅 세션 목록 조회를 위한 인덱스
  @@index([userId])
  /// 논문별 채팅 세션 조회를 위한 인덱스
  @@index([paperId])
  /// 최신순 정렬을 위한 인덱스
  @@index([createdAt])
}

/// AI 채팅 메시지 모델
/// 세션 내의 개별 메시지 (사용자 질문 + AI 답변)
model ChatMessage {
  /// 메시지 고유 ID (UUID)
  id String @id @default(uuid())

  /// 채팅 세션 ID
  chatSessionId String

  /// 채팅 세션 객체
  /// 세션 삭제 시 메시지도 함께 삭제 (Cascade)
  chatSession ChatSession @relation(fields: [chatSessionId], references: [id], onDelete: Cascade)

  /// 메시지 내용
  /// 사용자 질문 또는 AI 답변
  content String @db.Text

  /// 메시지 역할
  /// USER: 사용자 질문
  /// ASSISTANT: AI 답변
  /// SYSTEM: 시스템 메시지 (예: "대화 시작")
  role ChatMessageRole

  /// AI 응답 시 참조된 논문 ID 배열
  /// AI가 답변을 생성할 때 참고한 논문들
  /// 예: ["paper-id-1", "paper-id-2"]
  /// 출처 표시 및 추가 읽을거리 제공에 사용
  referencedPaperIds String[] @default([])

  /// 메시지 생성 시각
  createdAt DateTime @default(now())

  /// 세션별 메시지 목록 조회를 위한 인덱스
  @@index([chatSessionId])
  /// 시간순 정렬을 위한 인덱스
  @@index([createdAt])
}

/// 채팅 메시지 역할
enum ChatMessageRole {
  /// 사용자 - 사용자가 보낸 질문
  USER

  /// AI 어시스턴트 - AI가 생성한 답변
  ASSISTANT

  /// 시스템 - 시스템 메시지 (대화 시작, 종료 등)
  SYSTEM
}
