model ChatSession {
  id String @id @default(uuid())

  userId String
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  paperId String?
  paper   Paper?  @relation(fields: [paperId], references: [id], onDelete: Cascade)

  messages ChatMessage[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([userId])
  @@index([paperId])
  @@index([createdAt])
}

model ChatMessage {
  id String @id @default(uuid())

  chatSessionId String
  chatSession   ChatSession @relation(fields: [chatSessionId], references: [id], onDelete: Cascade)

  content String @db.Text

  role ChatMessageRole

  referencedPaperIds String[] @default([])

  createdAt DateTime @default(now())

  @@index([chatSessionId])
  @@index([createdAt])
}

enum ChatMessageRole {
  USER
  ASSISTANT
  SYSTEM
}
